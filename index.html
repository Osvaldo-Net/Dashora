<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dashora</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Space+Grotesk:wght@300;400;500;600;700&family=Space+Mono:ital,wght@0,400;0,700;1,400&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/styles.css">
</head>
<body>
    <div class="sidebar-overlay" id="sidebarOverlay" onclick="closeSidebar()"></div>

    <aside class="sidebar" id="sidebar">
        <div class="sidebar-section">
            <div class="clock-display">
                <div style="display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:12px;">
                    <div style="flex:1;"></div>
                    <button class="clock-settings-btn" onclick="toggleClockSettings()" title="Configuración">
                        <svg viewBox="0 0 24 24" width="16" height="16"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                    </button>
                </div>
                <div class="clock-time" id="clockTime">--:--</div>
                <div class="clock-date" id="clockDate">Cargando...</div>
                <div class="clock-timezone" id="clockTimezone"></div>
                <div class="clock-settings-panel" id="clockSettingsPanel" style="display:none;">
                    <div class="clock-setting-item">
                        <label for="timezoneSelect">Zona horaria</label>
                        <select id="timezoneSelect">
                            <option value="auto">Automática</option>
                            <optgroup label="América">
                                <option value="America/New_York">Nueva York</option>
                                <option value="America/Chicago">Chicago</option>
                                <option value="America/Denver">Denver</option>
                                <option value="America/Los_Angeles">Los Ángeles</option>
                                <option value="America/Mexico_City">Ciudad de México</option>
                                <option value="America/Bogota">Bogotá</option>
                                <option value="America/Lima">Lima</option>
                                <option value="America/Argentina/Buenos_Aires">Buenos Aires</option>
                                <option value="America/Sao_Paulo">São Paulo</option>
                                <option value="America/Caracas">Caracas</option>
                            </optgroup>
                            <optgroup label="Europa">
                                <option value="Europe/London">Londres</option>
                                <option value="Europe/Paris">París</option>
                                <option value="Europe/Berlin">Berlín</option>
                                <option value="Europe/Madrid">Madrid</option>
                                <option value="Europe/Rome">Roma</option>
                                <option value="Europe/Moscow">Moscú</option>
                            </optgroup>
                            <optgroup label="Asia">
                                <option value="Asia/Dubai">Dubái</option>
                                <option value="Asia/Kolkata">India</option>
                                <option value="Asia/Shanghai">Shanghái</option>
                                <option value="Asia/Tokyo">Tokio</option>
                                <option value="Asia/Seoul">Seúl</option>
                                <option value="Asia/Singapore">Singapur</option>
                            </optgroup>
                            <optgroup label="Oceanía">
                                <option value="Australia/Sydney">Sídney</option>
                                <option value="Pacific/Auckland">Auckland</option>
                            </optgroup>
                        </select>
                    </div>
                    <div class="clock-setting-item">
                        <label for="timeFormatSelect">Formato</label>
                        <select id="timeFormatSelect">
                            <option value="24">24 horas</option>
                            <option value="12">12 horas</option>
                        </select>
                    </div>
                </div>
            </div>
        </div>
        <div class="sidebar-section">
            <div class="calendar-container">
                <div class="calendar-header">
                    <div class="calendar-month" id="calendarMonth">Mes Año</div>
                    <div class="calendar-nav">
                        <button class="calendar-nav-btn" onclick="changeMonth(-1)"><svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg></button>
                        <button class="calendar-nav-btn" onclick="changeMonth(1)"><svg viewBox="0 0 24 24"><path d="M10 6L8.59 7.41 13.17 12l-4.58 4.59L10 18l6-6z"/></svg></button>
                    </div>
                </div>
                <div class="calendar-weekdays">
                    <div class="calendar-weekday">D</div><div class="calendar-weekday">L</div>
                    <div class="calendar-weekday">M</div><div class="calendar-weekday">M</div>
                    <div class="calendar-weekday">J</div><div class="calendar-weekday">V</div>
                    <div class="calendar-weekday">S</div>
                </div>
                <div class="calendar-days" id="calendarDays"></div>
            </div>
        </div>
        <div class="sidebar-section">
            <div class="weather-container">
                <div class="weather-header">
                    <div style="display:flex;align-items:center;gap:8px;">
                        <svg width="18" height="18" viewBox="0 0 24 24" style="fill:var(--accent);"><path d="M6.76 4.84l-1.8-1.79-1.41 1.41 1.79 1.79 1.42-1.41zM4 10.5H1v2h3v-2zm9-9.95h-2V3.5h2V.55zm7.45 3.91l-1.41-1.41-1.79 1.79 1.41 1.41 1.79-1.79zm-3.21 13.7l1.79 1.8 1.41-1.41-1.8-1.79-1.4 1.4zM20 10.5v2h3v-2h-3zm-8-5c-3.31 0-6 2.69-6 6s2.69 6 6 6 6-2.69 6-6-2.69-6-6-6zm-1 16.95h2V19.5h-2v2.95zm-7.45-3.91l1.41 1.41 1.79-1.8-1.41-1.41-1.79 1.8z"/></svg>
                        <span style="font-size:0.85rem;font-weight:600;color:var(--text-primary);">Clima</span>
                    </div>
                    <button class="weather-refresh-btn" onclick="loadWeather()" title="Actualizar">
                        <svg viewBox="0 0 24 24" width="14" height="14"><path d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/></svg>
                    </button>
                </div>
                <div class="weather-content" id="weatherContent">
                    <div style="text-align:center;padding:20px;color:var(--text-secondary);font-size:0.85rem;">Cargando clima...</div>
                </div>
            </div>
        </div>
        <div class="sidebar-section">
            <div class="background-settings-container">
                <div class="background-settings-header">
                    <div style="display:flex;align-items:center;gap:8px;">
                        <svg width="18" height="18" viewBox="0 0 24 24" style="fill:var(--accent);"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                        <span style="font-size:0.85rem;font-weight:600;color:var(--text-primary);">Fondo</span>
                    </div>
                    <button class="background-settings-btn" onclick="toggleBackgroundSettings()" title="Configuración">
                        <svg viewBox="0 0 24 24" width="16" height="16"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>
                    </button>
                </div>
                <div class="background-settings-panel" id="backgroundSettingsPanel" style="display:none;">
                    <div class="background-upload-area" id="backgroundUploadArea">
                        <input type="file" id="backgroundFile" accept="image/*" onchange="handleBackgroundUpload(event)" style="display:none;">
                        <label for="backgroundFile" class="background-upload-label">
                            <svg viewBox="0 0 24 24" width="24" height="24"><path d="M21 19V5c0-1.1-.9-2-2-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z"/></svg>
                            <span id="backgroundUploadText">Subir imagen</span>
                        </label>
                    </div>
                    <div class="background-setting-item">
                        <label for="backgroundOpacity">
                            Opacidad
                            <span class="background-opacity-value" id="backgroundOpacityValue">50%</span>
                        </label>
                        <input type="range" id="backgroundOpacity" min="0" max="100" value="50" oninput="updateBackgroundOpacity(this.value)">
                    </div>
                    <div class="background-actions">
                        <button class="btn btn-secondary btn-sm" onclick="removeBackground()" id="removeBackgroundBtn" style="display:none;">
                            <svg viewBox="0 0 24 24" width="14" height="14"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
                            Quitar fondo
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </aside>

    <button class="sidebar-toggle" id="sidebarToggle" onclick="toggleSidebar()">
        <div class="bars"><span class="bar"></span><span class="bar"></span><span class="bar"></span></div>
    </button>

    <div class="container">
        <header>
            <div class="header-content">
                <div class="header-top">
                    <div class="header-text">
                        <h1>Dashora</h1>
                        <p class="subtitle">Todos tus servicios en un solo lugar.</p>
                    </div>
                    <div class="header-actions">
                        <button class="header-btn" onclick="openModal('service')">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6v2z"/></svg>
                            <span class="btn-text">Nuevo servicio</span>
                        </button>
                        <button class="header-btn" onclick="openModal('group')" style="background:transparent;border-color:var(--border-color);color:var(--text-secondary);">
                            <svg viewBox="0 0 24 24" width="16" height="16" fill="currentColor"><path d="M10 4H4c-1.1 0-2 .9-2 2v12c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2h-8l-2-2z"/></svg>
                            <span class="btn-text">Nuevo grupo</span>
                        </button>
                        <button class="theme-toggle" onclick="toggleTheme()" title="Cambiar tema">
                            <svg id="theme-icon-light" viewBox="0 0 24 24" style="display:none;"><path d="M12 18c-3.3 0-6-2.7-6-6s2.7-6 6-6 6 2.7 6 6-2.7 6-6 6zm0-10c-2.2 0-4 1.8-4 4s1.8 4 4 4 4-1.8 4-4-1.8-4-4-4zM13 2h-2v3h2V2zm0 17h-2v3h2v-3zM5 11H2v2h3v-2zm17 0h-3v2h3v-2zM6.3 4.9L4.9 6.3l2.1 2.1 1.4-1.4-2.1-2.1zm12.7 12.7l-1.4 1.4 2.1 2.1 1.4-1.4-2.1-2.1zM17.7 6.3l-2.1 2.1 1.4 1.4 2.1-2.1-1.4-1.4zM6.3 19.1l2.1-2.1-1.4-1.4-2.1 2.1 1.4 1.4z"/></svg>
                            <svg id="theme-icon-dark" viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9 9-4.03 9-9c0-.46-.04-.92-.1-1.36-.98 1.37-2.58 2.26-4.4 2.26-2.98 0-5.4-2.42-5.4-5.4 0-1.81.89-3.42 2.26-4.4-.44-.06-.9-.1-1.36-.1z"/></svg>
                        </button>
                    </div>
                </div>
                <div class="search-container">
                    <svg class="search-icon" viewBox="0 0 24 24" width="18" height="18">
                        <path d="M15.5 14h-.79l-.28-.27C15.41 12.59 16 11.11 16 9.5 16 5.91 13.09 3 9.5 3S3 5.91 3 9.5 5.91 16 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79l5 4.99L20.49 19l-4.99-5zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/>
                    </svg>
                    <input
                        type="text"
                        id="searchInput"
                        class="search-input"
                        placeholder="Buscar servicios... (presiona / para enfocar)"
                        autocomplete="off"
                    />
                    <button class="search-clear" id="searchClear" onclick="clearSearch()" style="display:none;">
                        <svg viewBox="0 0 24 24" width="18" height="18">
                            <path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>
                        </svg>
                    </button>
                </div>
            </div>
        </header>
        <div class="sysinfo-section">
            <div class="sysinfo" id="sysinfo">
                <div class="sysinfo-chip"><svg viewBox="0 0 24 24"><path d="M21 3H3c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h18c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H3V5h18v14z"/></svg><span>Cargando...</span></div>
            </div>
        </div>
        <div id="groupsContainer"></div>
        <div id="emptyState" class="empty-state" style="display:none;">
            <div class="empty-state-icon">??</div>
            <div class="empty-state-text">Todo listo para empezar</div>
            <p class="empty-state-description">Agrega tu primer grupo o servicio con el botón de arriba</p>
        </div>
    </div>

    <!-- MAIN MODAL -->
    <div id="mainModal" class="modal">
        <div class="modal-content">
            <h2 class="modal-header" id="modalTitle">Agregar</h2>
            <p class="modal-sub" id="modalSub">Elige qué quieres crear</p>
            <div class="modal-tabs" id="modalTabs">
                <button class="modal-tab active" id="tab-service" onclick="switchTab('service')">Servicio</button>
                <button class="modal-tab" id="tab-group" onclick="switchTab('group')">Grupo</button>
            </div>
            <div class="tab-panel active" id="panel-service">
                <form id="serviceForm">
                    <input type="hidden" id="edit-service-id" value="">
                    <div class="form-group">
                        <label for="service-group">Grupo <span class="label-hint">(opcional)</span></label>
                        <select id="service-group"></select>
                    </div>
                    <div class="form-group">
                        <label for="title">Nombre del Servicio</label>
                        <input type="text" id="title" placeholder="Ej: GitHub" autocomplete="off">
                    </div>
                    <div class="form-group">
                        <label>Icono <span class="label-hint">(opcional)</span></label>
                        <div class="icon-input-tabs">
                            <button type="button" class="icon-tab active" data-tab="url" onclick="switchIconTab('url')">
                                <svg viewBox="0 0 24 24" width="16" height="16"><path d="M3.9 12c0-1.71 1.39-3.1 3.1-3.1h4V7H7c-2.76 0-5 2.24-5 5s2.24 5 5 5h4v-1.9H7c-1.71 0-3.1-1.39-3.1-3.1zM8 13h8v-2H8v2zm9-6h-4v1.9h4c1.71 0 3.1 1.39 3.1 3.1s-1.39 3.1-3.1 3.1h-4V17h4c2.76 0 5-2.24 5-5s-2.24-5-5-5z"/></svg>
                                URL
                            </button>
                            <button type="button" class="icon-tab" data-tab="upload" onclick="switchIconTab('upload')">
                                <svg viewBox="0 0 24 24" width="16" height="16"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/></svg>
                                Subir
                            </button>
                        </div>

                        <!-- Tab URL -->
                        <div class="icon-tab-content active" id="icon-tab-url">
                            <input type="url" id="icon" placeholder="https://ejemplo.com/icono.png" oninput="previewIconUrl()">
                        </div>

                        <!-- Tab Upload -->
                        <div class="icon-tab-content" id="icon-tab-upload">
                            <div class="file-upload-area" id="fileUploadArea">
                                <input type="file" id="iconFile" accept="image/*" onchange="handleIconUpload(event)" style="display:none;">
                                <label for="iconFile" class="file-upload-label">
                                    <svg viewBox="0 0 24 24" width="32" height="32"><path d="M19 12v7H5v-7H3v7c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-7h-2zm-6 .67l2.59-2.58L17 11.5l-5 5-5-5 1.41-1.41L11 12.67V3h2v9.67z"/></svg>
                                    <span>Click para seleccionar imagen</span>
                                    <small>PNG, JPG, SVG, GIF (máx. 2MB)</small>
                                </label>
                            </div>
                        </div>

                        <div class="icon-preview" id="iconPreview" style="display:none;">
                            <div class="icon-preview-box"><img id="iconPreviewImg" src="" alt="preview" onerror="this.parentElement.innerHTML='?'"></div>
                            <span class="icon-preview-hint">Vista previa del icono</span>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="url">URL del Servicio</label>
                        <input type="url" id="url" placeholder="https://github.com">
                    </div>
                    <div class="form-group">
                        <label for="description">Descripción <span class="label-hint">(máx. 23 caracteres)</span></label>
                        <input type="text" id="description" placeholder="Ej: Repositorio de código" maxlength="23" autocomplete="off">
                        <div style="font-size:0.75rem;color:var(--text-secondary);margin-top:4px;">
                            <span id="char-count">0</span>/23 caracteres
                        </div>
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary" id="serviceSubmitBtn">Agregar Servicio</button>
                    </div>
                </form>
            </div>
            <div class="tab-panel" id="panel-group">
                <form id="groupForm">
                    <input type="hidden" id="edit-group-old-name" value="">
                    <div class="form-group">
                        <label for="new-group-name">Nombre del Grupo</label>
                        <input type="text" id="new-group-name" placeholder="Ej: Inteligencia Artificial" autocomplete="off">
                    </div>
                    <div class="button-group">
                        <button type="button" class="btn btn-secondary" onclick="closeModal()">Cancelar</button>
                        <button type="submit" class="btn btn-primary" id="groupSubmitBtn">Crear Grupo</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- CONFIRM DIALOG -->
    <div id="confirmModal" class="confirm-modal">
        <div class="confirm-content">
            <div class="confirm-icon" id="confirmIcon">??</div>
            <div class="confirm-title" id="confirmTitle">¿Estás seguro?</div>
            <p class="confirm-msg" id="confirmMsg">Esta acción no se puede deshacer.</p>
            <div class="confirm-actions">
                <button class="btn btn-secondary" onclick="closeConfirm()">Cancelar</button>
                <button class="btn btn-danger" id="confirmOkBtn">Eliminar</button>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script src="/static/js/app.js"></script>
</body>
</html>
